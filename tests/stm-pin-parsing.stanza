#use-added-syntax(tests)
defpackage ocdb/tests/stm-pin-parsing : 
  import core
  import collections

  import ocdb/scripts/cubemx-importer-utils

deftest(ocdb, stm-pin-parsing) test-extract-pin-name :
  val pinnames = [
    "ANA0"                         => "ANA[0]",
    "ANA1"                         => "ANA[1]",
    "ANT_IN"                       => "ANT_IN",
    "ANT_NC"                       => "ANT_NC",
    "AOP1_INN"                     => "AOP_INN[1]",
    "AOP2_INN"                     => "AOP_INN[2]",
    "AT0"                          => "AT[0]",
    "AT1"                          => "AT[1]",
    "BOOT0"                        => "BOOT[0]",
    "BOOT1"                        => "BOOT[1]",
    "BOOT2"                        => "BOOT[2]",
    "BYPASS_REG"                   => "BYPASS_REG",
    "BYPASS_REG1V8"                => "BYPASS_REG1V8",
    "DDR_A0"                       => "DDR_A[0]",
    "DDR_A1"                       => "DDR_A[1]",
    "DDR_A10"                      => "DDR_A[10]",
    "DDR_A11"                      => "DDR_A[11]",
    "DDR_A12"                      => "DDR_A[12]",
    "DDR_A13"                      => "DDR_A[13]",
    "DDR_A14"                      => "DDR_A[14]",
    "DDR_A15"                      => "DDR_A[15]",
    "DDR_A2"                       => "DDR_A[2]",
    "DDR_A3"                       => "DDR_A[3]",
    "DDR_A4"                       => "DDR_A[4]",
    "DDR_A5"                       => "DDR_A[5]",
    "DDR_A6"                       => "DDR_A[6]",
    "DDR_A7"                       => "DDR_A[7]",
    "DDR_A8"                       => "DDR_A[8]",
    "DDR_A9"                       => "DDR_A[9]",
    "DDR_ATO"                      => "DDR_ATO",
    "DDR_BA0"                      => "DDR_BA[0]",
    "DDR_BA1"                      => "DDR_BA[1]",
    "DDR_BA2"                      => "DDR_BA[2]",
    "DDR_CASN"                     => "DDR_CASN",
    "DDR_CKE"                      => "DDR_CKE",
    "DDR_CLKN"                     => "DDR_CLKN",
    "DDR_CLKP"                     => "DDR_CLKP",
    "DDR_CSN"                      => "DDR_CSN",
    "DDR_DQ0"                      => "DDR_DQ[0]",
    "DDR_DQ1"                      => "DDR_DQ[1]",
    "DDR_DQ10"                     => "DDR_DQ[10]",
    "DDR_DQ11"                     => "DDR_DQ[11]",
    "DDR_DQ12"                     => "DDR_DQ[12]",
    "DDR_DQ13"                     => "DDR_DQ[13]",
    "DDR_DQ14"                     => "DDR_DQ[14]",
    "DDR_DQ15"                     => "DDR_DQ[15]",
    "DDR_DQ16"                     => "DDR_DQ[16]",
    "DDR_DQ17"                     => "DDR_DQ[17]",
    "DDR_DQ18"                     => "DDR_DQ[18]",
    "DDR_DQ19"                     => "DDR_DQ[19]",
    "DDR_DQ2"                      => "DDR_DQ[2]",
    "DDR_DQ20"                     => "DDR_DQ[20]",
    "DDR_DQ21"                     => "DDR_DQ[21]",
    "DDR_DQ22"                     => "DDR_DQ[22]",
    "DDR_DQ23"                     => "DDR_DQ[23]",
    "DDR_DQ24"                     => "DDR_DQ[24]",
    "DDR_DQ25"                     => "DDR_DQ[25]",
    "DDR_DQ26"                     => "DDR_DQ[26]",
    "DDR_DQ27"                     => "DDR_DQ[27]",
    "DDR_DQ28"                     => "DDR_DQ[28]",
    "DDR_DQ29"                     => "DDR_DQ[29]",
    "DDR_DQ3"                      => "DDR_DQ[3]",
    "DDR_DQ30"                     => "DDR_DQ[30]",
    "DDR_DQ31"                     => "DDR_DQ[31]",
    "DDR_DQ4"                      => "DDR_DQ[4]",
    "DDR_DQ5"                      => "DDR_DQ[5]",
    "DDR_DQ6"                      => "DDR_DQ[6]",
    "DDR_DQ7"                      => "DDR_DQ[7]",
    "DDR_DQ8"                      => "DDR_DQ[8]",
    "DDR_DQ9"                      => "DDR_DQ[9]",
    "DDR_DQM0"                     => "DDR_DQM[0]",
    "DDR_DQM1"                     => "DDR_DQM[1]",
    "DDR_DQM2"                     => "DDR_DQM[2]",
    "DDR_DQM3"                     => "DDR_DQM[3]",
    "DDR_DQS0N"                    => "DDR_DQSN[0]",
    "DDR_DQS0P"                    => "DDR_DQSP[0]",
    "DDR_DQS1N"                    => "DDR_DQSN[1]",
    "DDR_DQS1P"                    => "DDR_DQSP[1]",
    "DDR_DQS2N"                    => "DDR_DQSN[2]",
    "DDR_DQS2P"                    => "DDR_DQSP[2]",
    "DDR_DQS3N"                    => "DDR_DQSN[3]",
    "DDR_DQS3P"                    => "DDR_DQSP[3]",
    "DDR_DTO0"                     => "DDR_DTO[0]",
    "DDR_DTO1"                     => "DDR_DTO[1]",
    "DDR_ODT"                      => "DDR_ODT",
    "DDR_RASN"                     => "DDR_RASN",
    "DDR_RESETN"                   => "DDR_RESETN",
    "DDR_VREF"                     => "DDR_VREF",
    "DDR_WEN"                      => "DDR_WEN",
    "DDR_ZQ"                       => "DDR_ZQ",
    "DNC"                          => "DNC",
    "DNU"                          => "DNU",
    "DSIHOST_CKN"                  => "DSIHOST_CKN",
    "DSIHOST_CKP"                  => "DSIHOST_CKP",
    "DSIHOST_D0N"                  => "DSIHOST_DN[0]",
    "DSIHOST_D0P"                  => "DSIHOST_DP[0]",
    "DSIHOST_D1N"                  => "DSIHOST_DN[1]",
    "DSIHOST_D1P"                  => "DSIHOST_DP[1]",
    "DSI_CKN"                      => "DSI_CKN",
    "DSI_CKP"                      => "DSI_CKP",
    "DSI_D0N"                      => "DSI_DN[0]",
    "DSI_D0P"                      => "DSI_DP[0]",
    "DSI_D1N"                      => "DSI_DN[1]",
    "DSI_D1P"                      => "DSI_DP[1]",
    "IRROFF"                       => "IRROFF",
    "JTCK-SWCLK"                   => "JTCK",
    "JTDI"                         => "JTDI",
    "JTDO-TRACESWO"                => "JTDO",
    "JTMS-SWDIO"                   => "JTMS",
    "NC"                           => "NC",
    "NJTRST"                       => "NJTRST",
    "NPOR"                         => "NPOR",
    "NRST"                         => "NRST",
    "NRST(PB11)"                   => "NRST",
    "NRST_CORE"                    => "NRST_CORE",
    "OPAMP1_VINM"                  => "OPAMP_VINM[1]",
    "OPAMP2_VINM"                  => "OPAMP_VINM[2]",
    "OPAMP3_VINM"                  => "OPAMP_VINM[3]",
    "OSC_IN"                       => "OSC_IN",
    "OSC_OUT"                      => "OSC_OUT",
    "OTG_VBUS"                     => "OTG_VBUS",
    "PA0"                          => "PA[0]",
    "PA0-CK_IN"                    => "PA[0]",
    "PA0-WKUP"                     => "PA[0]",
    "PA0-WKUP1"                    => "PA[0]",
    "PA0/WKUP"                     => "PA[0]",
    "PA0_C"                        => "PA_C[0]",
    "PA1"                          => "PA[1]",
    "PA10 [PA12]"                  => "PA[10]",
    "PA10"                         => "PA[10]",
    "PA11 [PA9]"                   => "PA[11]",
    "PA11"                         => "PA[11]",
    "PA12 [PA10]"                  => "PA[12]",
    "PA12"                         => "PA[12]",
    "PA13 (JTMS-SWDIO)"            => "PA[13]",
    "PA13 (JTMS/SWDIO)"            => "PA[13]",
    "PA13"                         => "PA[13]",
    "PA13(JTMS/SWDIO)"             => "PA[13]",
    "PA14 (JTCK-SWCLK)"            => "PA[14]",
    "PA14 (JTCK/SWCLK)"            => "PA[14]",
    "PA14"                         => "PA[14]",
    "PA14(JTCK/SWCLK)"             => "PA[14]",
    "PA14-BOOT0"                   => "PA[14]",
    "PA15 (JTDI)"                  => "PA[15]",
    "PA15"                         => "PA[15]",
    "PA15(JTDI)"                   => "PA[15]",
    "PA1_C"                        => "PA_C[1]",
    "PA2"                          => "PA[2]",
    "PA3"                          => "PA[3]",
    "PA4"                          => "PA[4]",
    "PA5"                          => "PA[5]",
    "PA6"                          => "PA[6]",
    "PA7"                          => "PA[7]",
    "PA8"                          => "PA[8]",
    "PA9 [PA11]"                   => "PA[9]",
    "PA9"                          => "PA[9]",
    "PB0"                          => "PB[0]",
    "PB0-VDD_TCXO"                 => "PB[0]",
    "PB1"                          => "PB[1]",
    "PB10"                         => "PB[10]",
    "PB11"                         => "PB[11]",
    "PB12"                         => "PB[12]",
    "PB13"                         => "PB[13]",
    "PB14"                         => "PB[14]",
    "PB15"                         => "PB[15]",
    "PB2"                          => "PB[2]",
    "PB2/BOOT1"                    => "PB[2]",
    "PB3 (JTDO-TRACESWO)"          => "PB[3]",
    "PB3 (JTDO/TRACESWO)"          => "PB[3]",
    "PB3"                          => "PB[3]",
    "PB3(JTDO/TRACESWO)"           => "PB[3]",
    "PB4 (NJTRST)"                 => "PB[4]",
    "PB4"                          => "PB[4]",
    "PB4(NJTRST)"                  => "PB[4]",
    "PB5"                          => "PB[5]",
    "PB6"                          => "PB[6]",
    "PB7"                          => "PB[7]",
    "PB8"                          => "PB[8]",
    "PB8-BOOT0"                    => "PB[8]",
    "PB9"                          => "PB[9]",
    "PB9-BOOT0"                    => "PB[9]",
    "PC0"                          => "PC[0]",
    "PC1"                          => "PC[1]",
    "PC10"                         => "PC[10]",
    "PC11"                         => "PC[11]",
    "PC12"                         => "PC[12]",
    "PC13"                         => "PC[13]",
    "PC13-ANTI_TAMP"               => "PC[13]",
    "PC13-TAMPER-RTC"              => "PC[13]",
    "PC13-WKUP2"                   => "PC[13]",
    "PC14 - OSC32_IN"              => "PC[14]",
    "PC14 / OSC32_IN"              => "PC[14]",
    "PC14-OSC32_IN (OSC32_IN)"     => "PC[14]",
    "PC14-OSC32_IN (PC14)"         => "PC[14]",
    "PC14-OSC32_IN"                => "PC[14]",
    "PC14/OSC32_IN"                => "PC[14]",
    "PC14OSC32_IN"                 => "PC[14]",
    "PC15 - OSC32_OUT"             => "PC[15]",
    "PC15 / OSC32_OUT"             => "PC[15]",
    "PC15-OSC32_OUT (OSC32_OUT)"   => "PC[15]",
    "PC15-OSC32_OUT (PC15)"        => "PC[15]",
    "PC15-OSC32_OUT"               => "PC[15]",
    "PC15/OSC32_OUT"               => "PC[15]",
    "PC15OSC32_OUT"                => "PC[15]",
    "PC2"                          => "PC[2]",
    "PC2_C"                        => "PC_C[2]",
    "PC3"                          => "PC[3]",
    "PC3_C"                        => "PC_C[3]",
    "PC4"                          => "PC[4]",
    "PC5"                          => "PC[5]",
    "PC6"                          => "PC[6]",
    "PC7"                          => "PC[7]",
    "PC8"                          => "PC[8]",
    "PC9"                          => "PC[9]",
    "PD0"                          => "PD[0]",
    "PD0-OSC_IN"                   => "PD[0]",
    "PD1"                          => "PD[1]",
    "PD1-OSC_OUT"                  => "PD[1]",
    "PD10"                         => "PD[10]",
    "PD11"                         => "PD[11]",
    "PD12"                         => "PD[12]",
    "PD13"                         => "PD[13]",
    "PD14"                         => "PD[14]",
    "PD15"                         => "PD[15]",
    "PD2"                          => "PD[2]",
    "PD3"                          => "PD[3]",
    "PD4"                          => "PD[4]",
    "PD5"                          => "PD[5]",
    "PD6"                          => "PD[6]",
    "PD7"                          => "PD[7]",
    "PD8"                          => "PD[8]",
    "PD9"                          => "PD[9]",
    "PDR_ON"                       => "PDR_ON",
    "PDR_ON_CORE"                  => "PDR_ON_CORE",
    "PE0"                          => "PE[0]",
    "PE1"                          => "PE[1]",
    "PE10"                         => "PE[10]",
    "PE11"                         => "PE[11]",
    "PE12"                         => "PE[12]",
    "PE13"                         => "PE[13]",
    "PE14"                         => "PE[14]",
    "PE15"                         => "PE[15]",
    "PE2"                          => "PE[2]",
    "PE3"                          => "PE[3]",
    "PE4"                          => "PE[4]",
    "PE5"                          => "PE[5]",
    "PE6"                          => "PE[6]",
    "PE6-WKUP3"                    => "PE[6]",
    "PE7"                          => "PE[7]",
    "PE8"                          => "PE[8]",
    "PE9"                          => "PE[9]",
    "PF0 / OSC_IN"                 => "PF[0]",
    "PF0"                          => "PF[0]",
    "PF0-OSC_IN (PF0)"             => "PF[0]",
    "PF0-OSC_IN"                   => "PF[0]",
    "PF1 / OSC_OUT"                => "PF[1]",
    "PF1"                          => "PF[1]",
    "PF1-OSC_OUT (PF1)"            => "PF[1]",
    "PF1-OSC_OUT"                  => "PF[1]",
    "PF10"                         => "PF[10]",
    "PF11"                         => "PF[11]",
    "PF11BOOT0"                    => "PF[11]",
    "PF12"                         => "PF[12]",
    "PF13"                         => "PF[13]",
    "PF14"                         => "PF[14]",
    "PF15"                         => "PF[15]",
    "PF2 - NRST"                   => "PF[2]",
    "PF2"                          => "PF[2]",
    "PF2-NRST"                     => "PF[2]",
    "PF3"                          => "PF[3]",
    "PF4"                          => "PF[4]",
    "PF5"                          => "PF[5]",
    "PF6"                          => "PF[6]",
    "PF7"                          => "PF[7]",
    "PF8"                          => "PF[8]",
    "PF9"                          => "PF[9]",
    "PG0"                          => "PG[0]",
    "PG1"                          => "PG[1]",
    "PG10"                         => "PG[10]",
    "PG10-NRST"                    => "PG[10]",
    "PG11"                         => "PG[11]",
    "PG12"                         => "PG[12]",
    "PG13"                         => "PG[13]",
    "PG14"                         => "PG[14]",
    "PG15"                         => "PG[15]",
    "PG2"                          => "PG[2]",
    "PG3"                          => "PG[3]",
    "PG4"                          => "PG[4]",
    "PG5"                          => "PG[5]",
    "PG6"                          => "PG[6]",
    "PG7"                          => "PG[7]",
    "PG8"                          => "PG[8]",
    "PG9"                          => "PG[9]",
    "PH0 - OSC_IN"                 => "PH[0]",
    "PH0"                          => "PH[0]",
    "PH0-OSC_IN (PH0)"             => "PH[0]",
    "PH0-OSC_IN"                   => "PH[0]",
    "PH0/OSC_IN"                   => "PH[0]",
    "PH1 - OSC_OUT"                => "PH[1]",
    "PH1"                          => "PH[1]",
    "PH1-OSC_OUT (PH1)"            => "PH[1]",
    "PH1-OSC_OUT"                  => "PH[1]",
    "PH1/OSC_OUT"                  => "PH[1]",
    "PH10"                         => "PH[10]",
    "PH11"                         => "PH[11]",
    "PH12"                         => "PH[12]",
    "PH13"                         => "PH[13]",
    "PH14"                         => "PH[14]",
    "PH15"                         => "PH[15]",
    "PH2"                          => "PH[2]",
    "PH3"                          => "PH[3]",
    "PH3-BOOT0 (BOOT0)"            => "PH[3]",
    "PH3-BOOT0"                    => "PH[3]",
    "PH4"                          => "PH[4]",
    "PH5"                          => "PH[5]",
    "PH6"                          => "PH[6]",
    "PH7"                          => "PH[7]",
    "PH8"                          => "PH[8]",
    "PH9"                          => "PH[9]",
    "PI0"                          => "PI[0]",
    "PI1"                          => "PI[1]",
    "PI10"                         => "PI[10]",
    "PI11"                         => "PI[11]",
    "PI12"                         => "PI[12]",
    "PI13"                         => "PI[13]",
    "PI14"                         => "PI[14]",
    "PI15"                         => "PI[15]",
    "PI2"                          => "PI[2]",
    "PI3"                          => "PI[3]",
    "PI4"                          => "PI[4]",
    "PI5"                          => "PI[5]",
    "PI6"                          => "PI[6]",
    "PI7"                          => "PI[7]",
    "PI8"                          => "PI[8]",
    "PI8- ANTI TAMP2"              => "PI[8]",
    "PI8-RTC_AF2"                  => "PI[8]",
    "PI9"                          => "PI[9]",
    "PJ0"                          => "PJ[0]",
    "PJ1"                          => "PJ[1]",
    "PJ10"                         => "PJ[10]",
    "PJ11"                         => "PJ[11]",
    "PJ12"                         => "PJ[12]",
    "PJ13"                         => "PJ[13]",
    "PJ14"                         => "PJ[14]",
    "PJ15"                         => "PJ[15]",
    "PJ2"                          => "PJ[2]",
    "PJ3"                          => "PJ[3]",
    "PJ4"                          => "PJ[4]",
    "PJ5"                          => "PJ[5]",
    "PJ6"                          => "PJ[6]",
    "PJ7"                          => "PJ[7]",
    "PJ8"                          => "PJ[8]",
    "PJ9"                          => "PJ[9]",
    "PK0"                          => "PK[0]",
    "PK1"                          => "PK[1]",
    "PK2"                          => "PK[2]",
    "PK3"                          => "PK[3]",
    "PK4"                          => "PK[4]",
    "PK5"                          => "PK[5]",
    "PK6"                          => "PK[6]",
    "PK7"                          => "PK[7]",
    "PWR_LP"                       => "PWR_LP",
    "PWR_ON"                       => "PWR_ON",
    "PZ0"                          => "PZ[0]",
    "PZ1"                          => "PZ[1]",
    "PZ2"                          => "PZ[2]",
    "PZ3"                          => "PZ[3]",
    "PZ4"                          => "PZ[4]",
    "PZ5"                          => "PZ[5]",
    "PZ6"                          => "PZ[6]",
    "PZ7"                          => "PZ[7]",
    "REGOFF"                       => "REGOFF",
    "REXTPHYHS"                    => "REXTPHYHS",
    "RF1"                          => "RF1",
    "RFI_N"                        => "RFI_N",
    "RFI_P"                        => "RFI_P",
    "RFO_HP"                       => "RFO_HP",
    "RFO_LP"                       => "RFO_LP",
    "RFU"                          => "RFU",
    "RF_OUT"                       => "RF_OUT",
    "UCPD1_DBCC1"                  => "UCPD1_DBCC[1]",
    "UCPD1_DBCC2"                  => "UCPD1_DBCC[2]",
    "USB_DM1"                      => "USB_DM[1]",
    "USB_DM2"                      => "USB_DM[2]",
    "USB_DP1"                      => "USB_DP[1]",
    "USB_DP2"                      => "USB_DP[2]",
    "USB_RREF"                     => "USB_RREF",
    "V12PHYHS"                     => "V12PHYHS",
    "V15SMPS"                      => "V15SMPS",
    "VBAT"                         => "VBAT",
    "VCAP"                         => "VCAP",
    "VCAP1"                        => "VCAP[1]",
    "VCAP2"                        => "VCAP[2]",
    "VCAPDSI"                      => "VCAPDSI",
    "VCAP_1"                       => "VCAP_[1]",
    "VCAP_2"                       => "VCAP_[2]",
    "VDD"                          => "VDD",
    "VDD/VDDA"                     => "VDD",
    "VDD12"                        => "VDD12",
    "VDD12DSI"                     => "VDD12DSI",
    "VDD1V2_DSI_PHY"               => "VDD1V2_DSI_PHY",
    "VDD1V2_DSI_REG"               => "VDD1V2_DSI_REG",
    "VDD1V2_Unused"                => "VDD1V2_Unused",
    "VDD33USB"                     => "VDD33USB",
    "VDD33_USB"                    => "VDD33_USB",
    "VDD3V3_USB"                   => "VDD3V3_USB",
    "VDD3V3_USBFS"                 => "VDD3V3_USBFS",
    "VDD3V3_USBHS"                 => "VDD3V3_USBHS",
    "VDD50USB"                     => "VDD50USB",
    "VDD50_USB"                    => "VDD50_USB",
    "VDDA"                         => "VDDA",
    "VDDA/VREF+"                   => "VDDA",
    "VDDA1V1_REG"                  => "VDDA1V1_REG",
    "VDDA1V8_DSI"                  => "VDDA1V8_DSI",
    "VDDA1V8_REG"                  => "VDDA1V8_REG",
    "VDDA1V8_Unused"               => "VDDA1V8_Unused",
    "VDDCAP"                       => "VDDCAP",
    "VDDCORE"                      => "VDDCORE",
    "VDDDSI"                       => "VDDDSI",
    "VDDIO2"                       => "VDDIO2",
    "VDDLDO"                       => "VDDLDO",
    "VDDMMC"                       => "VDDMMC",
    "VDDPA"                        => "VDDPA",
    "VDDPHYHS"                     => "VDDPHYHS",
    "VDDQ_DDR"                     => "VDDQ_DDR",
    "VDDRF"                        => "VDDRF",
    "VDDRF1V55"                    => "VDDRF1V55",
    "VDDSD"                        => "VDDSD",
    "VDDSD12"                      => "VDDSD12",
    "VDDSD3"                       => "VDDSD3",
    "VDDSDMMC"                     => "VDDSDMMC",
    "VDDSMPS"                      => "VDDSMPS",
    "VDDUSB"                       => "VDDUSB",
    "VDD_ANA"                      => "VDD_ANA",
    "VDD_DSI"                      => "VDD_DSI",
    "VDD_PLL"                      => "VDD_PLL",
    "VDD_PLL2"                     => "VDD_PLL2",
    "VDD_USB"                      => "VDD_USB",
    "VDD_Unused"                   => "VDD_Unused",
    "VFBSMPS"                      => "VFBSMPS",
    "VLCD"                         => "VLCD",
    "VLXSMPS"                      => "VLXSMPS",
    "VREF+"                        => "VREF+",
    "VREF-"                        => "VREF",
    "VREFSD+"                      => "VREFSD+",
    "VREFSD-"                      => "VREFSD",
    "VREF_+"                       => "VREF_+",
    "VR_PA"                        => "VR_PA",
    "VSS EXPOSED PAD"              => "VSS",
    "VSS"                          => "VSS",
    "VSS/VSSA"                     => "VSS",
    "VSSA"                         => "VSSA",
    "VSSA/VREF-"                   => "VSSA",
    "VSSDSI"                       => "VSSDSI",
    "VSSRF"                        => "VSSRF",
    "VSSSD"                        => "VSSSD",
    "VSSSD/VREFSD-"                => "VSSSD",
    "VSSSMPS"                      => "VSSSMPS",
    "VSS_ANA"                      => "VSS_ANA",
    "VSS_DSI"                      => "VSS_DSI",
    "VSS_PLL"                      => "VSS_PLL",
    "VSS_PLL2"                     => "VSS_PLL2",
    "VSS_USBHS"                    => "VSS_USBHS"
  ]

  for [input, output] in kvs(pinnames) do :
    var ret = extract-pin-name(input)
    ret = to-string(ref-ify(ret))
    #ASSERT(ret == output)

defn kvs<?K,?V> (xs:Seqable<KeyValue<?K,?V>>) :
  for x in xs seq : [key(x), value(x)]
